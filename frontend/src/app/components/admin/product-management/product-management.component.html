<div class="admin-container">
  <h2>üõ†Ô∏è Upravljanje izdelkov</h2>

  <!-- Product Form -->
  <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form">
    <div class="form-row">
      <div class="form-group" id="name-group">
        <label for="name">Ime izdelka *</label>
        <input id="name" formControlName="name" placeholder="Vnesite ime izdelka" [class.error]="hasFieldError('name')">
        <div class="error-message" *ngIf="hasFieldError('name')">
          {{ getFieldError('name') }}
        </div>
      </div>
      <div class="form-group" id="price-group">
        <label for="price">Cena (‚Ç¨) *</label>
        <input id="price" type="number" step="0.01" formControlName="price" placeholder="0.00"
          [class.error]="hasFieldError('price')">
        <div class="error-message" *ngIf="hasFieldError('price')">
          {{ getFieldError('price') }}
        </div>
      </div>
    </div>

    <div class="form-group" id="description-group">
      <label for="description">Opis</label>
      <textarea id="description" formControlName="description" placeholder="Vnesite opis izdelka"></textarea>
    </div>

    <div class="form-group" id="image-group">
      <label for="image_file">Slika izdelka *</label>
      <div class="file-upload-container">
        <input id="image_file" type="file" accept="image/*" (change)="onImageSelected($event)"
          [class.error]="hasFieldError('image_url')" #fileInput>
        <div class="file-upload-display" (click)="fileInput.click()">
          @if(!selectedImagePreview){
          <div class="upload-placeholder">
            <span class="upload-icon">üì∑</span>
            <span class="upload-text">Kliknite za nalaganje slike</span>
            <span class="upload-hint">JPG, PNG, GIF do 5MB</span>
          </div>
          }
          @if(selectedImagePreview){
          <div class="image-preview">
            <img [src]="selectedImagePreview" alt="Predogled izdelka">
            <div class="image-overlay">
              <span>Kliknite za spremembo slike</span>
            </div>
          </div>
          }
        </div>
      </div>
      @if(hasFieldError("image_url")) {
      <div class="error-message">
        {{ getFieldError('image_url') }}
      </div>
      }
    </div>

    <div class="form-row">
      <div class="form-group" id="category-group">
        <label for="category">Kategorija</label>
        <input id="category" formControlName="category" placeholder="npr. Stekleniƒçke, Pokrovƒçki">
      </div>
      <div class="form-group" id="stock-group">
        <label for="stock_quantity">Zaloga</label>
        <input id="stock_quantity" type="number" formControlName="stock_quantity" placeholder="0">
      </div>
    </div>

    <div class="form-group" id="colors-group">
      <label for="colors">Razpolo≈æljive barve</label>
      <input id="colors" formControlName="colors" placeholder="ƒårna, Modra, Rdeƒça, Bela">
      <small class="form-text">Podprte barve: ƒçrna, bela, modra, rdeƒça, zelena, rumena, siva, oran≈æna, vijoliƒçna, roza, rjava, kobalt modra</small>
    </div>

    <div class="form-group checkbox">
      <input id="is_active" type="checkbox" formControlName="is_active">
      <label for="is_active">Izdelek je aktiven in viden strankam</label>
    </div>

    <div class="form-actions">
      <button type="submit" [disabled]="productForm.invalid">
        {{ isEditing ? 'üíæ Posodobi izdelek' : '‚ú® Ustvari izdelek' }}
      </button>
      <button type="button" (click)="resetForm()" *ngIf="isEditing">
        ‚ùå Prekliƒçi urejanje
      </button>
    </div>
  </form>

  <!-- Product List -->
  <div class="product-list-admin">
    <h3>Obstojeƒçi izdelki</h3>
    <div *ngIf="products$ | async as products; else loading">
      <table *ngIf="products.length > 0; else noProducts">
        <thead>
          <tr>
            <th>Slika</th>
            <th>ID</th>
            <th>Ime izdelka</th>
            <th>Kategorija</th>
            <th>Cena</th>
            <th>Zaloga</th>
            <th>Status</th>
            <th>Dejanja</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of products">
            <td data-label="Slika">
              <div class="product-image">
                @if (product.image_url) {
                <img [src]="getImageUrl(product.image_url)" [alt]="product.name" class="product-thumbnail"
                  (error)="onImageError($event)" (load)="onImageLoad($event)">
                } @else {
                <div class="no-image">üì∑</div>
                }
              </div>
            </td>
            <td data-label="ID">{{ product.id }}</td>
            <td data-label="Ime izdelka">
              <div class="product-info">
                <span class="name">{{ product.name }}</span>
                <span class="description" *ngIf="product.description">
                  {{ product.description.length > 50 ? product.description.substring(0, 50) + '...' :
                  product.description }}
                </span>
              </div>
            </td>
            <td data-label="Kategorija">
              <span class="category">{{ product.category || 'Nekategorizirano' }}</span>
            </td>
            <td data-label="Cena">
              <span class="price">{{ product.price | currency:'EUR':'symbol':'1.2-2' }}</span>
            </td>
            <td data-label="Zaloga">
              <span class="stock">{{ product.stock_quantity }}</span>
            </td>
            <td data-label="Status">
              <span class="status" [class]="product.is_active ? 'status-active' : 'status-inactive'">
                {{ product.is_active ? 'Aktiven' : 'Neaktiven' }}
              </span>
            </td>
            <td data-label="Dejanja">
              <div class="actions">
                <button (click)="onEdit(product)">Uredi</button>
                <button (click)="onDelete(product.id)">Izbri≈°i</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <ng-template #noProducts>
        <div style="text-align: center; padding: 3rem; color: #6c757d;">
          <p style="font-size: 1.2rem;">üì¶ Ni najdenih izdelkov</p>
          <p>Ustvarite svoj prvi izdelek z zgornjo formo!</p>
        </div>
      </ng-template>
    </div>

    <ng-template #loading>
      <div class="loading">
        Nalaganje izdelkov...
      </div>
    </ng-template>
  </div>
</div>