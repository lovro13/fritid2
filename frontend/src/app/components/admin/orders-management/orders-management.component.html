<div class="admin-container">
  <div class="header-section">
    <h2>ğŸ“¦ Upravljanje naroÄil</h2>
    <button class="refresh-btn" (click)="loadOrders()">ğŸ”„ OsveÅ¾i</button>
  </div>

  <div class="orders-list" *ngIf="orders$ | async as orders; else loading">
    <div *ngIf="orders.length > 0; else noOrders" class="orders-grid">
      <div class="order-card" *ngFor="let order of orders" (click)="viewOrderDetails(order)">
        <div class="order-header">
          <div class="order-id">
            <strong>NaroÄilo #{{ order.id }}</strong>
            <span class="order-date">{{ formatDate(order.createdAt || order.created_at) }}</span>
          </div>
          <span class="status-badge" [ngClass]="getStatusClass(order.status)">
            {{ order.status }}
          </span>
        </div>
        
        <div class="order-body">
          <div class="customer-info">
            <div class="info-row">
              <span class="label">ğŸ‘¤ Stranka:</span>
              <span>{{ order.shippingFirstName }} {{ order.shippingLastName }}</span>
            </div>
            <div class="info-row">
              <span class="label">ğŸ“§ Email:</span>
              <span>{{ order.shippingEmail }}</span>
            </div>
            <div class="info-row">
              <span class="label">ğŸ“± Telefon:</span>
              <span>{{ order.shippingPhoneNumber }}</span>
            </div>
            <div class="info-row">
              <span class="label">ğŸ“ Naslov:</span>
              <span>{{ order.shippingAddress }}, {{ order.shippingPostalCode }} {{ order.shippingCity }}</span>
            </div>
            <div class="info-row">
              <span class="label">ğŸ’³ PlaÄilo:</span>
              <span>{{ getPaymentMethodLabel(order.paymentMethod) }}</span>
            </div>
          </div>
          
          <div class="order-summary">
            <div class="total-amount">
              <span class="label">Skupaj:</span>
              <span class="amount">{{ (order.totalAmount || order.total_amount) | number:'1.2-2' }} EUR</span>
            </div>
            <div class="items-count">
              <span>ğŸ“¦ {{ (order.orderItems?.length || order.order_items?.length || 0) }} izdelkov</span>
            </div>
          </div>
        </div>
        
        <div class="order-footer">
          <button class="view-details-btn" (click)="viewOrderDetails(order); $event.stopPropagation()">
            Podrobnosti â†’
          </button>
        </div>
      </div>
    </div>

    <ng-template #noOrders>
      <div class="no-orders">
        <p style="font-size: 1.5rem;">ğŸ“­</p>
        <p>Ni naroÄil</p>
      </div>
    </ng-template>
  </div>

  <ng-template #loading>
    <div class="loading">
      <div class="spinner"></div>
      <p>Nalaganje naroÄil...</p>
    </div>
  </ng-template>

  <!-- Order Details Modal -->
  <div class="modal-overlay" *ngIf="selectedOrder" (click)="closeDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>NaroÄilo #{{ selectedOrder.id }}</h3>
        <button class="close-btn" (click)="closeDetails()">âœ•</button>
      </div>
      
      <div class="modal-body">
        <div class="detail-section">
          <h4>ğŸ“‹ Informacije o naroÄilu</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">Datum naroÄila:</span>
              <span class="detail-value">{{ formatDate(selectedOrder.createdAt || selectedOrder.created_at) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Status:</span>
              <span class="detail-value">
                <span class="status-badge" [ngClass]="getStatusClass(selectedOrder.status)">
                  {{ selectedOrder.status }}
                </span>
              </span>
            </div>
            <div class="detail-item">
              <span class="detail-label">NaÄin plaÄila:</span>
              <span class="detail-value">{{ getPaymentMethodLabel(selectedOrder.paymentMethod) }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h4>ğŸ‘¤ Podatki o stranki</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">Ime in priimek:</span>
              <span class="detail-value">{{ selectedOrder.shippingFirstName }} {{ selectedOrder.shippingLastName }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Email:</span>
              <span class="detail-value">{{ selectedOrder.shippingEmail }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Telefon:</span>
              <span class="detail-value">{{ selectedOrder.shippingPhoneNumber }}</span>
            </div>
            <div class="detail-item full-width">
              <span class="detail-label">Naslov:</span>
              <span class="detail-value">{{ selectedOrder.shippingAddress }}, {{ selectedOrder.shippingPostalCode }} {{ selectedOrder.shippingCity }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section" *ngIf="selectedOrder.orderItems || selectedOrder.order_items">
          <h4>ğŸ›ï¸ Izdelki</h4>
          <table class="items-table">
            <thead>
              <tr>
                <th>Izdelek</th>
                <th>Barva</th>
                <th>KoliÄina</th>
                <th>Cena</th>
                <th>Skupaj</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of selectedOrder.orderItems || selectedOrder.order_items">
                <td>{{ item.product_name }}</td>
                <td>{{ item.color || '-' }}</td>
                <td class="text-center">{{ item.quantity }}</td>
                <td class="text-right">{{ item.price | number:'1.2-2' }} EUR</td>
                <td class="text-right"><strong>{{ (item.price * item.quantity) | number:'1.2-2' }} EUR</strong></td>
              </tr>
            </tbody>
            <tfoot>
              <tr class="total-row">
                <td colspan="4" class="text-right"><strong>Skupaj:</strong></td>
                <td class="text-right"><strong>{{ (selectedOrder.totalAmount || selectedOrder.total_amount) | number:'1.2-2' }} EUR</strong></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
