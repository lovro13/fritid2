<!-- payment-method.component.html -->
<div class="payment-container">
  <h2>Izberite naÄin plaÄila</h2>

  <!-- Order Summary -->
  <div class="order-summary">
    <h3>Povzetek naroÄila</h3>
    <div class="order-items">
      @for (item of cartItems; track item.product.id) {
        <div class="order-item">
          <span class="item-name">{{ item.product.name }}</span>
          <span class="item-quantity">x{{ item.quantity }}</span>
          <span class="item-price">{{ calculateItemPrice(item.product.price, item.quantity) | currency:'EUR' }}</span>
        </div>
      }
    </div>
    
    <div class="order-totals">
      <div class="total-line">
        <span>Cena vseh izdelkov(vkljuÄno z DDV):</span>
        <span>{{ subtotal | currency:'EUR' }}</span>
      </div>
      <div class="total-line">
        <span>Dostava:</span>
        <span>{{ shippingCost === 0 ? 'BrezplaÄno' : (shippingCost | currency:'EUR') }}</span>
      </div>
      @if (subtotal >= 50) {
        <div class="free-shipping-note">
          <small>ğŸ‰ BrezplaÄna dostava za naroÄila nad 50,00 â‚¬</small>
        </div>
      }
      <div class="total-line total-amount">
        <span><strong>Skupaj:</strong></span>
        <span><strong>{{ totalAmount | currency:'EUR' }}</strong></span>
      </div>
    </div>
  </div>

  <div class="payment-options">
    <!-- Card Payment -->
    <div class="payment-option" [class.selected]="selectedMethod === 'card'" (click)="selectMethod('card')">
      <div class="option-header">
        <i class="icon credit-card"></i>
        <h3>Kartica</h3>
      </div>
      <p>Varno plaÄilo s kreditno ali debetno kartico</p>
      <div class="card-icons">
        <i class="visa"></i>
        <i class="mastercard"></i>
        <i class="maestro"></i>
      </div>
    </div>

    <!-- Cash on Delivery -->
    <div class="payment-option" [class.selected]="selectedMethod === 'cash'" (click)="selectMethod('cash')">
      <div class="option-header">
        <i class="icon cash"></i>
        <h3>Po prevzetju</h3>
      </div>
      <p>PlaÄilo v gotovini ob prevzemu paketa</p>
    </div>

  <!-- Card Payment Form -->
  @if (selectedMethod === 'card') {
  <div class="payment-form">
    <h3>Podatki o kartici</h3>
    <form [formGroup]="cardForm" (ngSubmit)="processPayment()">
      <div class="form-group">
        <label for="cardNumber">Å tevilka kartice</label>
        <input id="cardNumber" type="text" formControlName="cardNumber" placeholder="1234 5678 9012 3456">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="expiryDate">Veljavnost</label>
          <input id="expiryDate" type="text" formControlName="expiryDate" placeholder="MM/YY">
        </div>

        <div class="form-group">
          <label for="cvv">CVV</label>
          <input id="cvv" type="text" formControlName="cvv" placeholder="123">
        </div>
      </div>

      <div class="form-group">
        <label for="cardHolder">Ime na kartici</label>
        <input id="cardHolder" type="text" formControlName="cardHolder" placeholder="Vnesite ime">
      </div>

      <div class="security-note">
        <i class="lock-icon"></i>
        <p>VaÅ¡i podatki so varni. VaÅ¡e plaÄilne podatke ne shranjujemo.</p>
      </div>

      <button type="submit" class="pay-button" [disabled]="cardForm.invalid">
        PlaÄaj {{ totalAmount | currency:'EUR' }}
      </button>
    </form>
  </div>
  }

  <!-- Cash on Delivery Confirmation -->
  @if (selectedMethod == 'cash') {

  <div class="payment-confirmation">
    <div class="confirmation-content">
      <i class="icon cash-large"></i>
      <h3>PlaÄilo po prevzetju</h3>
      <p>Pri prevzemu paketa boste plaÄali v gotovini.</p>
      <p>Skupni znesek: <strong>{{ totalAmount | currency:'EUR' }}</strong></p>
      <button class="confirm-button" (click)="confirmCashPayment()">Potrdi naroÄilo</button>
    </div>
  </div>
  }
</div>